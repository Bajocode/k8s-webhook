# Default values for kuberwebhook.
# This is a YAML-formatted file.
# Declare variables to be passed into your templates.

replicaCount: 1
image:
  repository: fabijanbajo/kuberwebhook
  tag: "2.6.9"
  pullPolicy: Always
imagePullSecrets: []
nameOverride: ""
fullnameOverride: ""
service:
  type: ClusterIP
  port: 80
ingress:
  enabled: true
  annotations:
    kubernetes.io/ingress.class: nginx
    certmanager.k8s.io/cluster-issuer: "letsencrypt-prod"
    certmanager.k8s.io/acme-challenge-type: http01
  hosts:
  - host: devops.fabijanbajo.com
    paths:
    - /hooks/github-webhook
  tls:
  - secretName: fabijanbajo-tls-secret
    hosts:
    - devops.fabijanbajo.com
resources:
  limits:
    cpu: 100m
    memory: 128Mi
  requests:
    cpu: 100m
    memory: 128Mi
nodeSelector: {}
tolerations: []
affinity: {}

webhook:
  github:
    endpoint: github-webhook  
    secret: "}VY*IsCn/OX:7R@"
    branch: master
    script: |-
      #!/bin/bash
      export COMMIT_HASH=$1 REPO_HTTPS=$2 REPO_SSH=$3
      sed -e "s|<TARGETTAG_REPLACEME>|$COMMIT_HASH|g" \
        -e "s|<REPOURL_REPLACEME>|$REPO_HTTPS|g" \
        /emptydir-volume/pipeline-job.yaml > /emptydir-volume/pipeline-job-replaced.yaml
      kubectl --token=$(cat /var/run/secrets/kubernetes.io/serviceaccount/token) \
        --server=https://$KUBERNETES_SERVICE_HOST:$KUBERNETES_SERVICE_PORT \
        --certificate-authority=/var/run/secrets/kubernetes.io/serviceaccount/ca.crt \
        apply -f /emptydir-volume/pipeline-job-replaced.yaml

pipelineJob:
  clone:
    cloningRepositoryUrl: <REPOURL_REPLACEME>
    sshSecret: ssh-secret
  build:
    buildToolImage:
      repository: gcr.io/makisu-project/makisu 
      tag: v0.1.11
      pullPolicy: Always
      makisuSecret: docker-registry-config
    targetImage:
      host: gcr.io
      repository: fabijanbajo/fabijanbajo
      tag: <TARGETTAG_REPLACEME>
  deploy:
    helmChart:
      name: fabijanbajo
      namespace: fabijanbajo
      path: kubernetes
